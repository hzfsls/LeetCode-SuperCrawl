## [1218.最长定差子序列 中文热门题解2](https://leetcode.cn/problems/longest-arithmetic-subsequence-of-given-difference/solutions/100000/tong-ge-lai-shua-ti-la-dong-tai-gui-hua-ue2q9)

作者：[tong-zhu](https://leetcode.cn/u/tong-zhu)


今天是我坚持写题解的第 93 天！

# 方法、动态规划

今天这道题比较简单，即使你不会动态规划都能解出来。

我们从头遍历数组，遇到一个数 x，判断 x-d 在不在数组里面即可知道，能不能形成以 x 为结尾的等差数组，同时，我们记录下来以 x 结尾的等差数组的长度，这样，在后续的遍历过程中，我们就可以使用得上这个长度了。

我们来举个例子，假设给定数组为 `[1,5,3,6,5,7]`，等差 `d=2`，辅助数组为 `dp`，求解的过程如下：

- 遍历到 1，发现 `1-2=-1` 不在 dp 数组，记录 `dp[1] = 1`，表示以 1 结尾的等差数列只有 1 个数；
- 遍历到 5，发现 `5-2=3` 不在 dp 数组，记录 `dp[5]=1`；
-  遍历到 3，发现 `3-2=1` 在 dp 数组且以 1 结尾的等差数列长度为 1，所以，记录 `dp[3]=dp[3-2]+1=2`，表示以 3 结尾的等差数列长度为 2；
- 遍历到 6，发现 `6-2=4` 不在 dp 数组，记录 `dp[6]=1`；
- 遍历到 5，发现 `5-2=3` 在 dp 数组，记录 `dp[5]=dp[5-2]+1=3`；
- 遍历到 7，发现 `7-2=5` 在 dp 数组，记录 `dp[7]=dp[7-2]+1=4`；
- 取 dp 数组中的最大值，即 4，所以，最长等差子序列的长度为 4。

这其实就是动态规划的递推过程，所以，我们可以定义动态规划如下：

- 状态定义：`dp[x]` 表示以 `x` 结尾的最长等差子序列的长度；
- 状态转移：`dp[x]=dp[x-d]+1`；
- 初始值：无；
- 返回值：$\max _{i=0}^n dp[arr[i]]$。

观察题目给定的数据范围为 $-10^4$ 到 $10^4$，且 d 的范围也是如此，为了防止越界，所以，我们声明一个 $4*10^4$ 的数组来记录以某个数结尾的长度。

请看代码：

```java
class Solution {
    public int longestSubsequence(int[] arr, int difference) {
        int ans = 0;
        int[] dp = new int[40001];
        for (int num : arr) {
            dp[num + 20000] = dp[num + 20000 - difference] + 1; 
            ans = Math.max(ans, dp[num + 20000]);
        }
        return ans;
    }
}
```

> 很多同学对 40001 和 20000 有疑问，补充一下：num 最小可取 -10000，d 最大可取 10000， num-d 最小为 -20000，数组下标不能是负数，所以 +20000。然后，num 最大可取 10000，d 最小可取 -10000，num-d 最大为 20000，再加上前面的 20000，所以，数组开辟的长度要大于 40000，取 40001 正好。

- 时间复杂度：$O(n)$，本题数据范围比较小，我们用数组来表示哈希表速度会更快一些，如果范围更大，可以考虑使用HashMap。
- 空间复杂度：$O(C)$，C 固定为 40001。

运行结果如下：

![image-20211105072846528](https://pic.leetcode-cn.com/1636069265-HmIHop-file_1636069274410)

# 最后

**如果对你有帮助，请点个赞吧，谢谢^^**

也可以[关注我](https://leetcode-cn.com/u/tong-zhu/)（公号：彤哥来刷题啦），每日分享题解，一起刷题，一起拿全家桶。