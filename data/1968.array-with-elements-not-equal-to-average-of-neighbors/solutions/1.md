## [1968.构造元素不等于两相邻元素平均值的数组 中文热门题解1](https://leetcode.cn/problems/array-with-elements-not-equal-to-average-of-neighbors/solutions/100000/ongou-zao-by-hqztrue-ukge)

作者：[hqztrue](https://leetcode.cn/u/hqztrue)

这题主流题解居然是排序我是没想到的。下面给两个 $O(n)$ 复杂度的做法。
1. 构造法。假设我们已经确定了数组的一个前缀，其中最后两个数为 $e$ 和 $d$。那么我们添加下一个数 $x$ 时只需满足 $x\neq 2d-e$，也就是说在剩余的数中最多有一个数不能选(因为原数组中的数互不相同)。如果我们一直重复添加下一个可行的数的步骤，直到剩余两个数 $a,b$ 时停止，那可能发生无论是按 $ab$ 排还是按 $ba$ 排都不对的情况(不少基于交换的题解的错误原因)。
所以我们在剩余三个数 $a,b,c$ 时停止。不妨假设此时固定的前缀的最后两个元素为 $e,d$，而 $b,c$ 两个数都满足$\neq 2d-e$(最坏情况下 $a$ 不满足)。尝试把 $b$ 添加到末尾，然后 $a,c$ 中一定有一个数满足$\neq 2b-d$ 且使得另一个数满足 $\neq (b+d)/2$，不妨假设是$a$，继续添加到末尾。那么 $c$ 会被排在最后，整个数组形如 $\cdots edbac$，如果出了问题一定是因为 $b+c=2a$。这时候我们回滚，把 $c$ 放在 $d$ 的后面，整个数组按 $\cdots edcba$ 的顺序排列。那么我们有$c+e\neq 2d$(一开始不失一般性的假设)，$b+d\neq 2c$(之前根据对称性的假设)，$a+c\neq 2b$(因为上一个排列方式失败时 $b+c=2a$)。复杂度 $O(n)$。
2. 随机选取排列直到成功为止。下面我们证明期望 $O(1)$ 轮就能停止。我们考虑一个有序三元组 $a_i,a_j,a_k$ 在随机排列中依序连续出现的概率，为 $\frac{(n-2)!}{n!}=\frac{1}{n(n-1)}$。那么只需计算出满足 $a_i+a_k=2a_j$ 的有序三元组个数。对于固定的 $a_j$ 满足 $j\leq \frac{n}{2}$(不妨假设$a_1,\dots,a_n$ 有序排列)，对于任意的 $i<j$，最多存在一个 $k$ 满足 $a_i+a_k=2a_j$，且此时一定有 $k>j$。所以对于 $i<j<k$ 的情形至多有 $j-1$ 个三元组。对称地，对于 $i>j>k$ 的情形也有至多 $j-1$ 个三元组。$j>\frac{n}{2}$ 的情况同理。对 $j$ 求和，总共有至多 $\frac{(n-1)^2}{2}$ 个满足条件的有序三元组。最后使用union bound，即可给出错误率上界 $\leq \frac{1}{n(n-1)}\cdot \frac{(n-1)^2}{2}\leq \frac{1}{2}$。所以期望随机两轮即可停止，复杂度 $O(n)$。
3. 其实把排序换成找中位数就也是 $O(n)$ 了。参见[324. Wiggle Sort II](https://leetcode.com/problems/wiggle-sort-ii/)的题解。